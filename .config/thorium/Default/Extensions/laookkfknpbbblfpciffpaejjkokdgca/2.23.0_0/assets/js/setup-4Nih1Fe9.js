const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/dynamic-import-helper-Gh3O-GNF.js","assets/js/array-YYQw31d9.js","assets/js/main-DaaZyiXy.js","assets/js/Logger-DgjqecXr.js","assets/js/string-DLOjEt1Y.js"])))=>i.map(i=>d[i]);
import{G as e,F as t,aN as s,c as i,aj as a,q as r,n as o,g as n,D as l,x as c,a2 as d,A as m,V as u,aO as h,h as p,ac as v}from"./dynamic-import-helper-Gh3O-GNF.js";import{I as b,C as f}from"./ClickOutside-DCLvi2fj.js";import{R as g}from"./ResizeSensor-ZXOsDHeC.js";import{A as w,g as k,I as C,a as _,s as y,D as S,S as I}from"./siteBlocker-D8fSfCdV.js";import"./localStorage-B4mFdj8F.js";import{_ as x}from"./main-DaaZyiXy.js";import{u as R}from"./internalDataMetrics-C_vQFJrM.js";import{n as j}from"./_plugin-vue2_normalizer-DeUNqxFl.js";import{g as M}from"./array-YYQw31d9.js";import{u as H,S as B}from"./streaks-aZsP8Pn2.js";import{c as P,a as D,S as L}from"./constants-Dqx3dGLK.js";import T from"./Popup-Bjdqr1_U.js";import{F as z}from"./FlashMessage-BIzq9sd2.js";import{p as F}from"./promisifiedChrome-YDDyAvDe.js";import{a as V,D as E}from"./constants-CALDQiUE.js";import"./Logger-DgjqecXr.js";import"./string-DLOjEt1Y.js";import"./modulepreload-polyfill--IJuvtTE.js";import"./BaseIcon-CCkbWtl5.js";import"./BaseDropdownContent-DpVJFI_8.js";import"./index-C2sSf61p.js";import"./flashMessageQueue-CiwsHFUx.js";import"./info-DdD9a7JK.js";import"./globalKeyEventManager-DTQSIy-h.js";import"./icon-close-DRlspKs3.js";const A=j(e({name:"SiteBlockerInterventionResistanceStreak",setup:()=>({internalDataMetrics:R()}),computed:{sitesResistedStreakMetric(){return this.internalDataMetrics.getMetric("streaksStats","getSitesResistedStreak")},sitesResistedStreak(){var e,t;return this.sitesResistedStreakMetric.value.storeLoaded?(null==(t=(e=this.sitesResistedStreakMetric.value).getterValue)?void 0:t.call(e))||0:"-"}}}),(function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"site-blocker-intervention-resistance-streak metric-type app-dash"},[t("div",{staticClass:"metric-stat"},[t("span",{attrs:{"data-test":"resistance-streak"}},[e._v(e._s(e.sitesResistedStreak))])]),e._m(0)])}),[function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"metric-label"},[t("span",{staticClass:"metric-label-name"},[e._v("Resistance streak")])])}],!1,null,"035e5669").exports;const W=j(e({name:"SiteBlockerInterventionAffirmation",setup:()=>({affirmation:M(w)})}),(function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"site-blocker-intervention-affirmation"},[e._v(" "+e._s(e.affirmation)+" ")])}),[],!1,null,"91e3e7ce").exports;const G=j(e({name:"SiteBlockerInterventionBypassBreath",emits:["complete"],data:()=>({text:"inhale",shrinking:!0}),async mounted(){await t(700),this.shrinking=!1,await t(3750),this.text="",await t(800),this.text="exhale",await t(600),this.shrinking=!0,await t(3750),this.text="",await t(1500),this.$emit("complete")}}),(function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"site-blocker-intervention-bypass-breath"},[t("div",{staticClass:"breath-title"},[e._v("Take a deep breath")]),t("div",{staticClass:"breath-content",class:{shrinking:e.shrinking}},[t("div",{staticClass:"circle"}),t("div",{staticClass:"circle"}),t("div",{staticClass:"circle"}),t("transition",{attrs:{name:"fade",mode:"out-in",duration:500}},[t("div",{key:e.text,staticClass:"text"},[e._v(e._s(e.text))])])],1)])}),[],!1,null,"cc77d2f6").exports,O=new m({feature:"site blocker"}),U=e({name:"SiteBlockerInterventionDashboard",components:{SiteBlockerInterventionResistanceStreak:A,SiteBlockerInterventionAffirmation:W,SiteBlockerInterventionBypassBreath:G,Popup:T,FlashMessage:z},setup(){const e=new URL(location.href).searchParams,t=s(!1);return{center:i(),topLeft:i(),searchParams:e,siteName:k(decodeURIComponent(e.get("sitename")||""),decodeURIComponent(e.get("metatitle")||""),decodeURIComponent(e.get("documenttitle")||""),decodeURIComponent(e.get("hostname")||"")),streaksStore:H(),lastFocus:localStorage.getItem(P),shouldShowFlashMessage:"true"===e.get("bypassDelayOver"),tabWasMuted:!1,tabId:null,isChromium:a(),metaKeyOrSymbol:"Cmd"===t?"⌘":t,DropdownPosition:V,DropdownAlignment:E}},data:()=>({topRowHeight:0,centerAboveHeight:0,bypassing:!1,dashboardVisible:!0,streakTipVisible:"true"!==localStorage.getItem(C)}),computed:{topRowHeightPx(){return this.topRowHeight+"px"},centerAboveHeightPx(){return this.centerAboveHeight+"px"}},async mounted(){var e;if(this.shouldShowFlashMessage){const e=(await x((async()=>{const{default:e}=await import("./dynamic-import-helper-Gh3O-GNF.js").then((e=>e.a$));return{default:e}}),__vite__mapDeps([0,1,2,3,4]))).default;await r(),e.$emit("flashMessage",{message:"It's been 5 minutes. Focus on what matters.",persist:5e3})}if(o.$emit("globalEvent:window:resize"),!this.isChromium)return;const t=await F.tabs.getCurrent();(null==t?void 0:t.id)&&(this.tabId=t.id,(null==(e=null==t?void 0:t.mutedInfo)?void 0:e.muted)?this.tabWasMuted=!0:(await F.tabs.update(this.tabId,{muted:!0}),window.addEventListener("beforeunload",this.unmuteTabBeforeUnload)),this.unregisterTabCloseInServiceWorker(),window.addEventListener("beforeunload",this.registerTabCloseInServiceWorker)),window.addEventListener("storage",(e=>{(e.key===D&&!_()||e.key===L&&"false"===e.newValue)&&(this.dashboardVisible=!1)}))},methods:{calculateGridRowHeights(){var e,t,s;((null==(e=this.center)?void 0:e.offsetHeight)??0)<0||(this.topRowHeight=(null==(t=this.topLeft)?void 0:t.offsetHeight)??0,this.centerAboveHeight=window.innerHeight/2-(((null==(s=this.center)?void 0:s.offsetHeight)??0)/2+this.topRowHeight))},startBypassing(){this.bypassing=!0,O.capture("intervention start tab bypass")},async close(){if(O.capture("intervention close tab",{currently_bypassing:this.bypassing}),!this.isChromium)return;const e=await n().tabs.getCurrent();(null==e?void 0:e.id)&&await n().tabs.remove(e.id)},async dismiss(){this.isChromium&&await this.streaksStore.create({subset:B.SitesResisted,timestamp:Date.now(),valid:!1,data:this.searchParams.get("hostname")||""}),this.dashboardVisible=!1},async openMomentum(e){await this.increaseStreak(),window.removeEventListener("beforeunload",this.registerTabCloseInServiceWorker),O.capture("intervention open momentum",{from:e}),this.isChromium?n().tabs.update({url:"/index.html"}):window.parent.location.href=window.location.origin+"/index.html"},async increaseStreak(){this.isChromium&&await this.streaksStore.create({subset:B.SitesResisted,timestamp:Date.now(),valid:!0})},async afterLeave(){if(this.tabId&&(this.tabWasMuted||(await F.tabs.update(this.tabId,{muted:!1}),window.removeEventListener("beforeunload",this.unmuteTabBeforeUnload))),this.bypassing){O.capture("intervention tab bypassed");const e=_();e&&y(e)}window.removeEventListener("beforeunload",this.registerTabCloseInServiceWorker),window.parent.postMessage(S,"*"),location.reload()},dismissStreakTip(){this.streakTipVisible=!1,localStorage.setItem(C,"true")},unmuteTabBeforeUnload(){this.tabId&&F.tabs.update(this.tabId,{muted:!1})},registerTabCloseInServiceWorker(){if(!this.tabId)return;if(!this.isChromium)return;const e=new l("");c.sendMessage({handler:"increaseStreakWhenTabClosed",args:[this.tabId,this.searchParams.get("hostname")||"",e.getEnv()]})},unregisterTabCloseInServiceWorker(){this.tabId&&this.isChromium&&c.sendMessage({handler:"removeStreakTabClosedListener",args:[this.tabId]})}}}),N=()=>{d(((e,t)=>({"1b4c4092":e.topRowHeightPx,"4d070114":e.centerAboveHeightPx})))},$=U.setup;U.setup=$?(e,t)=>(N(),$(e,t)):N;const K=j(e({name:"SiteBlockerIntervention",components:{SiteBlockerInterventionDashboard:j(U,(function(){var e=this,t=e._self._c;return e._self._setupProxy,t("transition",{attrs:{name:"fade-fast"},on:{"after-leave":e.afterLeave}},[e.dashboardVisible?t("div",{directives:[{name:"resize-sensor",rawName:"v-resize-sensor",value:e.calculateGridRowHeights,expression:"calculateGridRowHeights"}],staticClass:"site-blocker-intervention-dashboard dashboard dark dark-full"},[t("div",{staticClass:"top-row"},[t("div",{directives:[{name:"resize-sensor",rawName:"v-resize-sensor",value:e.calculateGridRowHeights,expression:"calculateGridRowHeights"}],ref:"topLeft",staticClass:"top-left"},[t("div",{staticClass:"dash-button dash-button-neutral open-momentum",on:{click:function(t){return e.openMomentum("button")}}},[e._v("Open Momentum")])]),t("div",{directives:[{name:"resize-sensor",rawName:"v-resize-sensor",value:e.calculateGridRowHeights,expression:"calculateGridRowHeights"}],staticClass:"top-right"},[e.isChromium?t("site-blocker-intervention-resistance-streak"):e._e()],1)]),t("div",{staticClass:"center-above"}),t("div",{directives:[{name:"resize-sensor",rawName:"v-resize-sensor",value:e.calculateGridRowHeights,expression:"calculateGridRowHeights"}],ref:"center",staticClass:"center"},[t("transition",{attrs:{name:"fade",mode:"out-in"}},[e.bypassing?t("site-blocker-intervention-bypass-breath",{staticClass:"center-content",on:{complete:e.dismiss}}):t("div",{staticClass:"center-content"},[t("div",{staticClass:"site-blocked"},[e._v("Site blocked"),e.lastFocus?t("span",[e._v(" • Focusing on")]):e._e()]),t("div",{staticClass:"current-focus",attrs:{"data-test":"current-focus"},on:{click:function(t){return e.openMomentum(e.lastFocus?"focus":"emptyFocus")}}},[e._v(e._s(e.lastFocus||"Focusing"))])])],1)],1),t("div",{staticClass:"center-below"},[t("div",{staticClass:"buttons",class:{"shortcut-help":!e.isChromium}},[e.isChromium?t("div",{staticClass:"dash-button close-tab",on:{click:e.close}},[e._v("Close tab")]):t("div",{staticClass:"dash-button close-tab no-pointer-events",on:{click:e.close}},[e._v("Press "+e._s(e.metaKeyOrSymbol)+" W to close tab")]),t("transition",{attrs:{name:"fade",mode:"out-in"}},[e.bypassing?e.isChromium?t("div",{key:"2",staticClass:"dash-button open-site no-pointer-events"},[e._v("By continuing you will break your resistance streak")]):e._e():t("div",{key:"1",staticClass:"dash-button open-site",on:{click:e.startBypassing}},[e._v("Open "+e._s(e.siteName))])])],1)]),t("div",{staticClass:"bottom-row"},[t("div",{staticClass:"bottom-center"},[t("site-blocker-intervention-affirmation")],1)]),t("transition",{attrs:{name:"fade-blurred-tip-app",appear:""}},[e.streakTipVisible&&e.dashboardVisible&&e.isChromium?t("popup",{attrs:{id:"intervention-streak-tooltip","target-element-selector":".site-blocker-intervention-resistance-streak",position:e.DropdownPosition.Bottom,alignment:e.DropdownAlignment.Right,"body-text":"Your streak resets if you open this website.",width:225,"nipple-displacement":25,"target-distance":5},on:{dismiss:e.dismissStreakTip}}):e._e()],1),e.shouldShowFlashMessage?t("flash-message"):e._e()],1):e._e()])}),[],!1,null,"beadc82d").exports}}),(function(){var e=this._self._c;return this._self._setupProxy,e("div",{staticClass:"site-blocker-intervention"},[e("site-blocker-intervention-dashboard")],1)}),[],!1,null,null).exports;window.addEventListener("resize",(()=>{r((()=>{o.$emit("globalEvent:window:resize")}))})),u.use(b),u.use(h),u.directive("resize-sensor",g),u.directive("click-outside",f),new u({render:()=>p(K),pinia:v()}).$mount("#app"),window.parent.postMessage(I,"*");