import{G as t,d as e,a1 as s,A as i}from"./dynamic-import-helper-Gh3O-GNF.js";import{O as o}from"./onboarding-BnjvsMNe.js";import{o as a}from"./oneTimeLoginService-CdNq_uct.js";import{S as r}from"./SmoothReflow-44YdkIfk.js";import{n}from"./_plugin-vue2_normalizer-DeUNqxFl.js";import"./array-YYQw31d9.js";import"./main-DaaZyiXy.js";import"./Logger-DgjqecXr.js";import"./string-DLOjEt1Y.js";import"./enums-Cgv4i8uw.js";import"./helpers-DBbhml_y.js";import"./TabLeaderElection-8EqWBm0z.js";import"./focusModeState-D4CLHiD7.js";import"./LocalStorageStoreSyncedItem-CtVH-muf.js";import"./onboarding-Bdvt2O8-.js";import"./compareObjects-BF7sSNEf.js";import"./modal-DNJEx5xp.js";import"./SubscriptionSummary-RRqVWeCc.js";import"./persistStore-7VuxlznA.js";import"./reactiveCustomization-CaJFMm70.js";import"./VueBase-CYtBAh2Z.js";import"./_commonjsHelpers-B3K3fdV-.js";import"./ClickOutside-DCLvi2fj.js";import"./pinia-CCjyjLnb.js";import"./portal-vue.esm-BTKM9g0x.js";import"./constants-CALDQiUE.js";import"./constants-BfBD_H-d.js";import"./authService-DSVbm6Rd.js";import"./auth-D2YAhF74.js";import"./legacyUserMigration-DJj0rzI-.js";import"./migrateLegacyUserMessageHandler-FH_m4diU.js";import"./login-kENE0gaj.js";import"./icon-confetti-BvRSomF2.js";import"./focusModeHelpers-CbYS8k-X.js";import"./PomodoroTimers-CyrfcuWH.js";import"./experiments-C9Yd4CP-.js";import"./siteBlockerGroups-9WPnbAn4.js";import"./constants-Dqx3dGLK.js";import"./SettingsTypes-BotgHBzA.js";import"./accessToken-tlcZZvow.js";import"./tasksMockData-Co81Ft0X.js";import"./tasksViewState-DusFQxW4.js";import"./ViewState-CalcjAWV.js";import"./appZStack-CXXM5U-T.js";import"./ResizeSensor-ZXOsDHeC.js";import"./allComponentsMounted-Dqy5K4Uf.js";const p=new i({feature:"one-time-login"});const l=n(t({name:"OneTimeLogin",components:{SmoothReflow:r},props:{subSteps:{type:Array,required:!0},activeSubStepIndex:{type:Number,required:!0},activeSubStep:{type:Object,required:!0},otlParams:{type:Object,default:void 0}},emits:["goToSubStep","dismiss","stepComplete"],setup:()=>({OneTimeLoginState:o,oneTimeLoginData:void 0,helpUrl:"https://get.momentumdash.help/hc/en-us/articles/19764520037143"}),data:()=>({processing:!1,errorResending:!1,emailSent:!1}),computed:{activeSubStepName(){var t;return(null==(t=this.activeSubStep)?void 0:t.name)??o.ERROR},resendButtonText(){return this.processing?"Processing…":"Re-send Link"}},async mounted(){var t;await this.redeemOneTimePassword();const s=e.userIsLegacyUnregistered()||!!localStorage.getItem("unregistered"),i=null==(t=this.oneTimeLoginData)?void 0:t.legacy;!s||i?await this.oneTimeLogin():this.setSubStep(o.UNSAVED_DATA)},methods:{setSubStep(t){const e=this.subSteps.findIndex((e=>e.name===t));-1!==e&&this.$emit("goToSubStep",e)},dismiss(){this.$emit("dismiss")},complete(){this.$emit("stepComplete")},displayErrorSubStep(t){var e;let i="string"==typeof t?t:"unknown error";t instanceof Error&&(null==t?void 0:t.message)&&(i=t.message);const a=s(t,{default:i});console.error(a),p.capture("one time login error",{message:a.message}),(null==(e=this.otlParams)?void 0:e.email)?this.setSubStep(o.ERROR_RESEND):this.setSubStep(o.ERROR)},goToRegistration(){m.cmd("modal.open","LOGIN",{force:!0})},async redeemOneTimePassword(){try{if(!this.otlParams)return this.displayErrorSubStep("no otl params defined");p.capture("one time password redeemed",{case:this.otlParams.ssoOutcome}),this.setSubStep(o.PROCESSING),a.startOneTimeLogin(),this.oneTimeLoginData=await a.redeemOneTimePassword(this.otlParams)}catch(t){this.displayErrorSubStep(t)}},async oneTimeLogin(){try{if(!this.oneTimeLoginData)return this.displayErrorSubStep("no one time login data");p.capture("one time login activated"),this.setSubStep(o.PROCESSING),await a.loginWithOneTimeLoginResponse(this.oneTimeLoginData),a.finalizeOneTimeLogin(),this.complete()}catch(t){this.displayErrorSubStep(t)}},reload(){location.reload()},async sendOtlEmail(){var t;this.errorResending=!1,this.emailSent=!1,this.processing=!0;const e=null==(t=this.otlParams)?void 0:t.email;try{if(!e)throw new Error("no email in params");await a.sendOneTimeLoginEmail(e),this.emailSent=!0}catch(s){console.error(s),this.errorResending=!0}finally{this.processing=!1}}}}),(function(){var t,e=this,s=e._self._c;return e._self._setupProxy,s("div",{staticClass:"one-time-login app reset-app-styles dark",attrs:{"data-test":"one-time-login"}},[s("transition",{attrs:{name:"fade",mode:"out-in",duration:350}},[s("div",{key:e.activeSubStepName,staticClass:"content",attrs:{"data-test":e.activeSubStepName}},[e.activeSubStepName===e.OneTimeLoginState.PROCESSING?[s("h2",[e._v("Logging you in to "+e._s(e.$partner.name)+"…")])]:e.activeSubStepName===e.OneTimeLoginState.UNSAVED_DATA?[s("h2",[e._v("Unsaved data found")]),s("p",[e._v("Create an account to save your data.")]),s("div",{staticClass:"actions"},[s("button",{staticClass:"dash-button dash-button-primary",attrs:{"data-test":"register"},on:{click:e.goToRegistration}},[e._v("Create account and save data")]),s("button",{staticClass:"dash-button",attrs:{"data-test":"proceed"},on:{click:e.oneTimeLogin}},[e._v("Continue without data")])]),s("div",{staticClass:"sub-actions"},[s("button",{attrs:{"data-test":"dismiss"},on:{click:e.dismiss}},[e._v("Cancel login")]),s("a",{attrs:{href:e.helpUrl}},[e._v("Help")])])]:e.activeSubStepName===e.OneTimeLoginState.ERROR_RESEND?[s("h2",[e._v("Your one-time login link has expired.")]),s("smooth-reflow",[e.errorResending?s("p",{key:"error",staticClass:"small"},[e._v("Oops, looks like something went wrong re-sending your link. Please ensure you are connected to the internet and try again. If the problem persists, please contact us.")]):e.emailSent?s("p",{key:"success",staticClass:"small"},[e._v("Your one-time login link has been sent! Please check your email.")]):s("p",{staticClass:"small"},[e._v("Re-send a one-time login link to "+e._s(null==(t=e.otlParams)?void 0:t.email)+".")])]),s("div",{staticClass:"actions horizontal"},[s("button",{staticClass:"dash-button dash-button-primary",on:{click:e.sendOtlEmail}},[e._v(e._s(e.resendButtonText))]),s("button",{staticClass:"dash-button",attrs:{"data-test":"dismiss"},on:{click:e.reload}},[e._v("Cancel")])]),s("div",{staticClass:"sub-actions"},[s("a",{attrs:{href:"https://momentumdash.com/contact","data-test":"contact-us"}},[e._v("Contact us")]),s("a",{attrs:{href:e.helpUrl}},[e._v("Help")])])]:e.activeSubStepName===e.OneTimeLoginState.ERROR?[s("h2",[e._v("Oops! Something didn't work")]),s("p",[e._v("If the problem persists, please contact us.")]),s("div",{staticClass:"actions horizontal"},[s("button",{staticClass:"dash-button dash-button-primary",attrs:{"data-test":"dismiss"},on:{click:e.reload}},[e._v("Dismiss")]),s("a",{staticClass:"dash-button",attrs:{href:"https://momentumdash.com/contact","data-test":"contact-us"}},[e._v("Contact us")])]),s("div",{staticClass:"sub-actions"},[s("a",{attrs:{href:e.helpUrl}},[e._v("Help")])])]:e._e()],2)])],1)}),[],!1,null,"9e897fdc").exports;export{l as default};