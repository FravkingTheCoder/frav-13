import{M as e,e as t,C as o,l as a,g as s,r,H as n}from"./dynamic-import-helper-Gh3O-GNF.js";import{p as x}from"./persistStore-7VuxlznA.js";import{b as i}from"./array-YYQw31d9.js";const u=x((({loadedRef:e})=>t("user",{state:()=>({uuid:""}),getters:{loaded:()=>e.value}})),{mode:e.Cache,syncAutomatically:!0});var l="2.23.0";const d=(e,t)=>e?(localStorage.setItem("token",e),t&&localStorage.setItem("token_uuid",t),o()?c():Promise.resolve({message:"Conditions to save token in app storage not met."})):Promise.reject("No token provided"),c=()=>{if(!o())return Promise.reject("saveTokenToAppStorage only works on Safari");const e=localStorage.getItem("token");if(!e)return Promise.reject("No token in localStorage");const t={token:e,tokenUuid:localStorage.getItem("token_uuid"),clientUuid:localStorage.getItem("client_uuid"),userUuid:a(),email:localStorage.getItem("email")};return s().runtime.sendNativeMessage("com.momentumdash.momentum.safari",{eventName:"setUserTokenInfo",userTokenInfo:JSON.stringify(t)}).catch((e=>{throw console.error(e),new Error("Error setting token in shared app storage")}))},g=()=>s().runtime.sendNativeMessage("com.momentumdash.momentum.safari",{eventName:"getUserTokenInfo"}).then((e=>(null==e?void 0:e.userTokenInfo)?JSON.parse(e.userTokenInfo):null)),f=async({token:e,token_uuid:t,settings:o,user_uuid:a,features:s})=>{localStorage.removeItem("unregistered"),localStorage.removeItem("registrationStatePending"),e&&await d(e),t&&localStorage.setItem("token_uuid",t),a&&(localStorage.setItem("user_uuid",a),localStorage.setItem("userId",a),u().uuid=a),o&&m.syncCoordinator.loadSettings(o),s&&m.conditionalFeatures.updateFeatures(s)},p=e=>/^([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22))*\x40([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d))*$/.test(e),S=e=>e.length>=6,k=()=>r.introductionActive||r.oneTimeLoginActive||n(),I=Object.freeze(Object.defineProperty({__proto__:null,authFlowIsPending:k,getTokenFromAppStorage:g,handleAuthResponse:f,isValidEmail:p,isValidPassword:S,saveTokenToAppStorage:c,setMomentumAuthHeader:e=>{const t=localStorage.getItem("token"),o=localStorage.getItem("client_uuid");if(t&&e.setRequestHeader("Authorization","Bearer "+t),o&&e.setRequestHeader("X-Momentum-ClientId",o),e.setRequestHeader("X-Momentum-Version",l),e.setRequestHeader("X-Momentum-ClientDate",i()),m.conditionalFeatures.featureEnabled("allowoptions")){const t=localStorage.getItem("X-Momentum-Options");t&&e.setRequestHeader("X-Momentum-Options",t)}const a=localStorage.getItem("activeTags");a&&e.setRequestHeader("X-Momentum-Tags",a)},setToken:d},Symbol.toStringTag,{value:"Module"}));export{p as a,I as b,k as c,g,f as h,S as i,c as s,u};