import{M as t}from"./Message-BcdCgI6p.js";import{V as a,c as n,A as i}from"./dynamic-import-helper-Gh3O-GNF.js";import{V as s}from"./VueBase-CYtBAh2Z.js";import{a as e}from"./allComponentsMounted-Dqy5K4Uf.js";import{persistent as r}from"./reactiveCustomization-CaJFMm70.js";import{T as o}from"./index-C_ay7xUY.js";import{s as p}from"./showAnyway-iBeVTgqC.js";import{a as d}from"./modal-D5eTjgvI.js";import{s as c}from"./enums-Cgv4i8uw.js";import{B as l}from"./BaseDropdownOption-C6EewfIZ.js";import g from"./BaseIcon-CCkbWtl5.js";import{B as u}from"./BaseDropdownDivider-Bay0Demn.js";import{B as h}from"./BaseDropdown-x2dYnnCF.js";import{n as v}from"./_plugin-vue2_normalizer-DeUNqxFl.js";import"./MobileBlur-B2s9dLKD.js";import"./array-YYQw31d9.js";import"./main-DaaZyiXy.js";import"./Logger-DgjqecXr.js";import"./string-DLOjEt1Y.js";import"./_commonjsHelpers-B3K3fdV-.js";import"./ClickOutside-DCLvi2fj.js";import"./pinia-CCjyjLnb.js";import"./portal-vue.esm-BTKM9g0x.js";import"./localStorage-B4mFdj8F.js";import"./legacyUserMigration-DJj0rzI-.js";import"./migrateLegacyUserMessageHandler-FH_m4diU.js";import"./auth-D2YAhF74.js";import"./persistStore-7VuxlznA.js";import"./embeddedApp-C73bLmHI.js";import"./experiments-C9Yd4CP-.js";import"./flashMessageQueue-CiwsHFUx.js";import"./info-DdD9a7JK.js";import"./constants-u23t4s7p.js";import"./index-byH5_iOK.js";import"./appZStack-CXXM5U-T.js";import"./ResizeSensor-ZXOsDHeC.js";import"./promisifiedChrome-YDDyAvDe.js";import"./modal-DNJEx5xp.js";import"./constants-CALDQiUE.js";import"./BaseDropdownContent-DpVJFI_8.js";import"./index-C2sSf61p.js";import"./icon-ellipsis-D7nTOXaQ.js";a.use(s);const w=new(a.extend({name:"MantraManager",manager:m.models.mantraManager,bb:()=>({mantras:m.collect.mantras,mantraSettings:m.models.mantraSettings}),computed:{pinned(){return this.mantraSettings?this.mantraSettings.pinnedMantra:null},active(){let t;if(this.pinned)return t=this.mantras.findWhere({forDate:"pinned"}),t&&t.get("_id")===this.pinned.id?t:null;if(this.mantras&&this.isEnabled()){if(t=this.mantras.getActiveItem(),!t)return m.trigger("sync:download","mantra"),null;if(t.get("hardSkip"))return null}return t}},watch:{active(t){!t&&this.pinned&&this.mantras.create({forDate:"pinned",_id:this.pinned.id,body:this.pinned.body,is_custom:this.pinned.isCustom,is_favorite:this.pinned.isFavorite})}},methods:{isEnabled:function(){return this.$options.manager.isEnabled()},pinMantra:function(t,a){this.$options.manager.pinMantra(t,a)},toggleFav:function(t){this.$options.manager.toggleFav(t)},skipItem:function(t){return this.$options.manager.skipItem(t)},getMantraForDisplay:function(t,a){return this.$options.manager.getMantraForDisplay(t,a)},markGreetingAsSeenToday:function(){this.$options.manager.markGreetingAsSeenToday()}}})),f=new i({feature:"mantra"});const j=v({name:"Mantra",components:{BaseDropdownDivider:u,BaseIcon:g,BaseDropdownOption:l,BaseDropdown:h,ThreeColLayout:o,Message:t},mixins:[e],props:{mantraOverride:{type:String,default:""}},setup:()=>({showAnyway:p,dropdown:n()}),data:()=>({editingName:!1,skipping:!1,useLastShowName:!1}),computed:{isFavorite(){return this.mantra&&this.mantra.activeMantra&&this.mantra.activeMantra.get("is_favorite")},isPinned(){return this.mantra&&this.mantra.activeMantra&&this.mantra.activeMantra.isPinned()},isCustom(){return this.mantra&&this.mantra.activeMantra&&this.mantra.activeMantra.get("is_custom")},mantra(){if(this.mantraOverride)return{activeMantra:"",content:this.mantraOverride,name:"",punctuation:""};const t=w.active,a=w.getMantraForDisplay(t,this.useLastShowName);return a?{activeMantra:t,content:a.start,name:a.name,punctuation:a.end||"."}:{activeMantra:"",content:" ",name:"",punctuation:""}},skipOrSkipping(){return this.skipping?"Skipping…":"Skip mantra"},pinOrUnpin(){return this.isPinned?"Unpin":"Pin"}},watch:{mantra(){this.useLastShowName=!0}},mounted(){m.trigger("mantra:mounted")},methods:{toggleDropdown(t){var a;this.$emit("stop-cycle",t),m.trigger("mantra:dropdown:visible",t),null==(a=this.dropdown)||a.openDropdown()},openMantraSettings(){var t;this.editingName||(m.commandManager.executeAsync("settings.display",null,{section:"mantra-settings"}),null==(t=this.dropdown)||t.closeDropdown())},toggleFavorite(){w.toggleFav(this.mantra.activeMantra),f.capture("mantra "+(this.isFavorite?"fav":"unfav"),{location:"dash",custom:this.isCustom})},togglePin(){if(!this.$plus)return void d(c.UPSELL_MANTRAS,"dash");f.capture("mantra "+(this.isPinned?"unpin":"pin"),{location:"dash",custom:this.isCustom,is_paid_event:!0});const t=this.mantra.name===r.displayname;w.pinMantra(this.mantra.activeMantra,t)},skip(){if(this.$plus){if(!this.mantra.activeMantra)return m.trigger("sync:download","mantra"),void this.$emit("show-greeting");f.capture("mantra skip",{custom:this.isCustom,is_paid_event:!0}),this.skipping=!0,w.skipItem().finally((()=>{var t;null==(t=this.dropdown)||t.closeDropdown(),this.skipping=!1}))}else d(c.UPSELL_MANTRAS,"dash")},dontShowAgain(){w.skipItem(!0).finally((()=>{var t;null==(t=this.dropdown)||t.closeDropdown(),this.$plus||this.$emit("show-greeting")})),f.capture("mantra don't show again")},editing(t){this.$emit("stop-cycle",t),this.editingName=t},onEditNameClick(){var t;this.editingName=!0,null==(t=this.dropdown)||t.closeDropdown(),i.capture("display name change",{feature:"profile"})}}},(function(){var t=this,a=t._self._c;return a("three-col-layout",{directives:[{name:"mobile-click",rawName:"v-mobile-click",value:t.toggleDropdown.bind(null,!0),expression:"toggleDropdown.bind(null, true)"}],staticClass:"app-container has-dash-icon greeting",class:{"show-anyway":t.showAnyway.includes("greeting")},attrs:{"data-show-anyway":"greeting","data-test":"mantra"},scopedSlots:t._u([{key:"center",fn:function(){return[a("message",{attrs:{message:t.mantra,"editing-name":t.editingName},on:{editing:t.editing,toggle:t.toggleDropdown}})]},proxy:!0},{key:"right",fn:function(){return[a("base-dropdown",{ref:"dropdown",attrs:{"container-class":"dash","data-test":"more-toggle"},scopedSlots:t._u([{key:"toggle",fn:function(){return[a("div",{staticClass:"icon-wrapper dark dark-full"},[a("base-icon",{staticClass:"icon",attrs:{src:"icon-ellipsis",size:"18px"}})],1)]},proxy:!0}])},[a("base-dropdown-option",{attrs:{"data-test":"favorite"},on:{click:t.toggleFavorite}},[a("base-icon",{attrs:{src:t.isFavorite?"heart-off":"heart"}}),a("span",[t._v(t._s(t.isFavorite?"Unfavorite":"Favorite"))])],1),a("base-dropdown-option",{attrs:{"data-test":"pin"},on:{click:t.togglePin}},[a("base-icon",{attrs:{src:t.isPinned?"pin-off":"pin"}}),a("span",[t._v(t._s(t.pinOrUnpin))])],1),a("base-dropdown-option",{attrs:{disabled:t.skipping,"data-test":"skip"},on:{click:t.skip}},[a("base-icon",{attrs:{src:"redo-dot"}}),a("span",[t._v(t._s(t.skipOrSkipping))])],1),t.isCustom?t._e():a("base-dropdown-option",{attrs:{"data-test":"dont-show-again"},on:{click:t.dontShowAgain}},[a("base-icon",{attrs:{src:"thumbs-down"}}),a("span",[t._v("Don't show again")])],1),a("base-dropdown-divider"),a("base-dropdown-option",{attrs:{"data-test":"mantra-settings"},on:{click:function(a){return a.stopPropagation(),t.openMantraSettings.apply(null,arguments)}}},[a("base-icon",{attrs:{src:"settings-2"}}),a("span",[t._v("Mantra settings")])],1),t.mantra.name?a("base-dropdown-option",{attrs:{"data-test":"edit-name"},on:{click:t.onEditNameClick}},[a("base-icon",{attrs:{src:"pencil"}}),a("span",[t._v("Edit your name")])],1):t._e()],1)]},proxy:!0}])})}),[],!1,null,"d8f78ee1").exports;export{j as default};