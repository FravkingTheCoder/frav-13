import{G as e,an as t,c as s,q as i,F as a,$ as o,o as r}from"./dynamic-import-helper-Gh3O-GNF.js";import{useSoundsViewStateStore as n,SoundsView as p}from"./soundsViewState-DDWq5mhi.js";import l from"./AppPopup-kxasHFCt.js";import{A as d}from"./AppViewSwitchDynamic-DUaF00u2.js";import{A as c}from"./AppView-D98wzsjm.js";import{A as u}from"./AppHeader-D7x6VYmc.js";import m from"./BaseIcon-CCkbWtl5.js";import{B as y}from"./BaseItemList-dKD1dgqB.js";import{u as h,L as v,a as b,b as f,c as S,d as w,e as g,f as I,g as k,h as _,i as A,P as x,j as C,k as j,S as V}from"./soundsPlayer-DcWIeeUN.js";import{S as B,a as T}from"./SoundsAudioCover-BJrM1ez0.js";import{n as O}from"./_plugin-vue2_normalizer-DeUNqxFl.js";import{B as L}from"./constants-BpVlFj04.js";import{A as D}from"./AppLoading-DWsYUtJy.js";import P from"./OverflowCarousel-BV1nq2ZZ.js";import{A as F}from"./AppHeaderControl-kJjUFX4q.js";import{g as E}from"./experiments-C9Yd4CP-.js";import{S as N}from"./state-BIDDPgIj.js";import{B as H}from"./BaseForm-CAbyV7zb.js";import{F as z}from"./FormEditableSpan-B3N16ueW.js";import{B as M}from"./BaseDropdown-x2dYnnCF.js";import{B as q}from"./BaseDropdownOption-C6EewfIZ.js";import{S as R}from"./Slider-Ad2U5Vve.js";import{D as $}from"./constants-CALDQiUE.js";import{T as G,A as Y}from"./AppActionBanner-BY1A1nUa.js";import{I as W}from"./IframeHost-IIjkx2YY.js";import{F as U,a as K}from"./FormFieldWrapper-CrSgQOtf.js";import{g as X}from"./globalKeyEventManager-DTQSIy-h.js";import"./array-YYQw31d9.js";import"./main-DaaZyiXy.js";import"./Logger-DgjqecXr.js";import"./string-DLOjEt1Y.js";import"./ViewState-CalcjAWV.js";import"./appZStack-CXXM5U-T.js";import"./ResizeSensor-ZXOsDHeC.js";import"./SmoothReflow-44YdkIfk.js";import"./allComponentsMounted-Dqy5K4Uf.js";import"./appViewSwitchMixin-BsLJ76Hr.js";import"./constants-BfBD_H-d.js";import"./icon-close-DRlspKs3.js";import"./index-C2sSf61p.js";import"./persistStore-7VuxlznA.js";import"./TabLeaderElection-8EqWBm0z.js";import"./focusModeState-D4CLHiD7.js";import"./LocalStorageStoreSyncedItem-CtVH-muf.js";import"./focusModeHelpers-CbYS8k-X.js";import"./reactiveCustomization-CaJFMm70.js";import"./VueBase-CYtBAh2Z.js";import"./_commonjsHelpers-B3K3fdV-.js";import"./ClickOutside-DCLvi2fj.js";import"./pinia-CCjyjLnb.js";import"./portal-vue.esm-BTKM9g0x.js";import"./PomodoroTimers-CyrfcuWH.js";import"./focusModeViewState-B4fUYtwj.js";import"./pomodoroCompleted-PtbKLdeQ.js";import"./promisifiedChrome-YDDyAvDe.js";import"./login-kENE0gaj.js";import"./authService-DSVbm6Rd.js";import"./auth-D2YAhF74.js";import"./legacyUserMigration-DJj0rzI-.js";import"./enums-Cgv4i8uw.js";import"./migrateLegacyUserMessageHandler-FH_m4diU.js";import"./onboarding-Bdvt2O8-.js";import"./modal-D5eTjgvI.js";import"./IframeMessenger-Dbsts-JD.js";import"./icon-next-CI-_n-sg.js";import"./FormMessage-D8y-6rLo.js";import"./icon-alert-BikrS7AG.js";import"./BaseDropdownContent-DpVJFI_8.js";import"./icon-ellipsis-D7nTOXaQ.js";import"./icon-error-state-DPDi2Xf2.js";const Q=e({name:"SoundsCurrentlyPlaying"});const Z=e({name:"SoundsLibraryListItem",components:{SoundsCurrentlyPlaying:O(Q,(function(){var e=this;return e._self._c,e._self._setupProxy,e._m(0)}),[function(){var e=this._self._c;return this._self._setupProxy,e("div",{staticClass:"sounds-currently-playing dark"},[e("div",{staticClass:"indicator"}),e("div",{staticClass:"indicator"}),e("div",{staticClass:"indicator"})])}],!1,null,"c20fdcbb").exports,SoundsPlayButton:B,SoundsAudioCover:T},props:{item:{type:Object,required:!0}},setup:()=>({playerStore:h(),viewStateStore:n(),capture:t("capture")}),computed:{active(){var e;return(null==(e=this.playerStore.activeItem)?void 0:e.id)===this.item.id},inactiveOrPaused(){return!this.active||this.playerStore.paused},playButtonClickCallback(){return this.active?e=>{e.stopPropagation(),this.playerStore.toggleActiveItemPaused()}:()=>{}}},methods:{updateViewAndPlayAudio(){var e;this.viewStateStore.activeViewItemId=this.item.id,this.viewStateStore.setActiveView(p.Item),this.playerStore.play(this.item.id),null==(e=this.capture)||e.call(this,"sounds library item click",{id:this.item.id,type:this.item.type,title:this.item.title})}}});const J=O(e({name:"SoundsLibraryList",components:{SoundsLibraryListItem:O(Z,(function(){var e=this,t=e._self._c;return e._self._setupProxy,t("li",{staticClass:"sounds-library-list-item",class:{active:e.active},attrs:{"data-test":"sounds-list-item","data-test-type":e.item.type},on:{click:e.updateViewAndPlayAudio}},[t("div",{staticClass:"cover-player"},[t("sounds-play-button",{attrs:{id:e.item.id,paused:e.inactiveOrPaused,size:e.active?"26px":"40px"},on:{click:e.playButtonClickCallback}}),t("transition",{attrs:{name:"fade-fast"}},[e.active&&!e.playerStore.paused?t("sounds-currently-playing"):e._e()],1),t("sounds-audio-cover",{attrs:{"thumbnail-url":e.item.thumbnailSrc,icon:e.item.icon??"",type:e.item.type}})],1),t("span",{staticClass:"item-title"},[e._v(e._s(e.item.title))])])}),[],!1,null,"d79f1b5d").exports,BaseItemList:y},props:{filter:{type:String,required:!0}},setup:()=>({playerStore:h(),viewStateStore:n(),emptyItemsArray:new Array(3),BaseItemListDirection:L}),computed:{allItemOrderedAndFiltered(){return this.playerStore.allItemsOrdered.filter((e=>!this.filter||("custom"===this.filter?e.custom:e.type===this.filter)))},filteredItemsEmpty(){return 0===this.allItemOrderedAndFiltered.length}}}),(function(){var e=this,t=e._self._c;return e._self._setupProxy,t("base-item-list",{staticClass:"sounds-library-list",attrs:{direction:e.BaseItemListDirection.Row,wrap:!0,"wrap-dynamic-item-width":91.6,gap:"var(--spacing-5)"}},[e.filteredItemsEmpty?e._l(e.emptyItemsArray,(function(e,s){return t("li",{key:s+1,staticClass:"empty-item"},[t("div",{staticClass:"pulse-background",style:{"--n":s}})])})):e._l(e.allItemOrderedAndFiltered,(function(e){return t("sounds-library-list-item",{key:e.id,attrs:{item:e}})}))],2)}),[],!1,null,"07ec091d").exports;const ee=O(e({name:"AppHeaderButton",props:{primary:{type:Boolean,default:!1},active:{type:Boolean,default:!1}},emits:["click"]}),(function(){var e=this,t=e._self._c;return e._self._setupProxy,t("button",{staticClass:"app-header-button button button-neutral",class:{active:e.active,primary:e.primary},on:{click:function(t){return e.$emit("click",t)}}},[e._t("default")],2)}),[],!1,null,"a9a5a6e4").exports,te=e({name:"AppFilter",components:{AppHeaderButton:ee,BaseItemList:y,OverflowCarousel:P},props:{value:{type:String,required:!0},options:{type:Array,required:!0}},emits:["input"],setup:()=>({BaseItemListDirection:L})});const se=O(e({name:"SoundsLibrary",components:{AppHeaderButton:ee,AppFilter:O(te,(function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"app-filter"},[t("overflow-carousel",{attrs:{direction:e.BaseItemListDirection.Row}},[t("base-item-list",{attrs:{direction:e.BaseItemListDirection.Row,gap:"var(--spacing-2)"}},e._l(e.options,(function(s){return t("app-header-button",{key:s.value||"default",attrs:{active:s.value===e.value},on:{click:function(t){return e.$emit("input",s.value)}}},[e._v(" "+e._s(s.label)+" ")])})),1)],1)],1)}),[],!1,null,"a3f3544d").exports,AppLoading:D,SoundsLibraryList:J,BaseIcon:m,AppHeader:u,AppView:c,AppHeaderControl:F},setup:()=>({playerStore:h(),viewStateStore:n(),LibraryFilterOptions:v,capture:t("capture")}),data:()=>({filter:v[0].value}),computed:{activeItemPlayingAndTabActive(){return!!this.playerStore.activeItem&&this.playerStore.isActiveTab},activeItemThumbnailSrc(){var e;return null==(e=this.playerStore.activeItem)?void 0:e.thumbnailSrc},addButtonExperiment:()=>E("sounds_add_button_styling"),useAddButtonOutlineStyling(){var e;return"outline_text"===(null==(e=this.addButtonExperiment)?void 0:e.variantName)}},methods:{async openActiveItemView(){this.playerStore.activeItem&&(this.viewStateStore.activeViewItemId=this.playerStore.activeItem.id,await this.viewStateStore.setActiveView(p.Item),await this.viewStateStore.togglePopup(!0))},async openAddEmbedView(){var e;null==(e=this.capture)||e.call(this,"sounds integration add click"),await this.viewStateStore.setActiveView(p.AddEmbed)}}}),(function(){var e=this,t=e._self._c;return e._self._setupProxy,t("app-view",{staticClass:"sounds-library",scopedSlots:e._u([{key:"header",fn:function(){return[t("app-header",{on:{close:function(t){return e.viewStateStore.togglePopup(!1,{resetActiveView:!1})}},scopedSlots:e._u([{key:"left",fn:function(){return[t("base-icon",{staticClass:"app-header-icon",attrs:{src:"icon/apps/sounds",size:"16px"}}),t("span",{staticClass:"app-header-name"},[e._v("Sounds")])]},proxy:!0},{key:"right",fn:function(){return[t("app-header-control",{staticClass:"add-embed",class:{outline:e.useAddButtonOutlineStyling},attrs:{"data-test":"add-embed"},on:{click:e.openAddEmbedView}},[t("base-icon",{attrs:{src:"icon-plus",size:e.useAddButtonOutlineStyling?"11px":"13px"}}),e.useAddButtonOutlineStyling?t("span",[e._v("Add")]):e._e()],1)]},proxy:!0}])}),t("div",{staticClass:"filter-playing"},[t("app-filter",{attrs:{options:e.LibraryFilterOptions},model:{value:e.filter,callback:function(t){e.filter=t},expression:"filter"}}),e.activeItemPlayingAndTabActive?t("app-header-button",{staticClass:"now-playing dark dark-full",attrs:{primary:!0},on:{click:e.openActiveItemView}},[t("span",[e._v("Now Playing")]),t("base-icon",{attrs:{src:"icon/arrow-right",size:"14px"}}),e.activeItemThumbnailSrc?t("img",{staticClass:"now-playing-image",attrs:{src:e.activeItemThumbnailSrc,alt:"Audio cover"}}):e._e()],1):e._e()],1)]},proxy:!0},{key:"body",fn:function(){return[t("transition",{attrs:{name:"fade-fast",mode:"out-in"}},[e.playerStore.loadedAllItems?t("sounds-library-list",{attrs:{filter:e.filter}}):t("app-loading",{attrs:{"data-test":"items-loading"}})],1)]},proxy:!0}])})}),[],!1,null,"2a1bb25f").exports,ie=e({name:"SoundsSoundscapeTrack",components:{Tooltip:G,Slider:R,BaseIcon:m},props:{soundscapeId:{type:String,required:!0},track:{type:Object,required:!0}},setup:()=>({soundscapesStore:b(),capture:t("capture"),volumeAnalyticsCaptureTimeout:void 0,DropdownAlignment:$}),computed:{trackIcon(){return f[this.track.id].icon},title(){return`Turn ${this.track.active?"off":"on"} ${f[this.track.id].title}`}},methods:{updateTrackVolume(e){this.soundscapesStore.updateTrack(this.soundscapeId,this.track.id,{volume:e}),clearTimeout(this.volumeAnalyticsCaptureTimeout),this.volumeAnalyticsCaptureTimeout=setTimeout((()=>{var t;null==(t=this.capture)||t.call(this,"sounds track volume update",{volume:e,id:this.track.id,soundscapeId:this.soundscapeId})}),300)},toggleTrackActive(){var e;const t=!this.track.active;this.soundscapesStore.updateTrack(this.soundscapeId,this.track.id,{active:t}),null==(e=this.capture)||e.call(this,"sounds track active toggle",{id:this.track.id,active:t,soundscapeId:this.soundscapeId})}}});const ae=O(e({name:"SoundsItemSoundscape",components:{SoundsSoundscapeTrack:O(ie,(function(){var e=this,t=e._self._c;return e._self._setupProxy,t("li",{staticClass:"sounds-soundscape-track",class:{disabled:!e.track.active}},[t("tooltip",{staticClass:"toggle-container",attrs:{label:e.title}},[t("div",{staticClass:"toggle-content",attrs:{"data-test":"sounds-track-item"},on:{click:e.toggleTrackActive}},[t("base-icon",{attrs:{src:e.trackIcon,size:"var(--spacing-6)"}})],1)]),t("div",{staticClass:"slider-content"},[t("slider",{attrs:{id:e.track.id,value:e.track.volume,min:.05,max:1,interval:.05,"data-test":"sounds-track-volume"},on:{input:e.updateTrackVolume}})],1)],1)}),[],!1,null,"b95ba59a").exports,BaseItemList:y,BaseDropdownOption:q,BaseDropdown:M,FormEditableSpan:z,BaseForm:H,AppHeaderControl:F,BaseIcon:m,SoundsAudioCover:T,AppHeader:u,AppView:c},setup:()=>({playerStore:h(),soundscapesStore:b(),viewStateStore:n(),optionsDropdown:s(),capture:t("capture"),SoundsDataType:N}),computed:{soundscape(){var e;const t=this.soundscapesStore.getSoundscapeOrDefaultFromId(this.viewStateStore.activeViewItemId);return t||(this.viewStateStore.activeViewItemId&&(null==(e=this.playerStore.activeItem)?void 0:e.type)===N.Soundscapes&&console.error("[Sounds] Unable to find soundscape with id:",this.viewStateStore.activeViewItemId),new S({}))},tracks(){return this.soundscape.tracks.filter((e=>!e.advanced))},isDefault(){return!!this.soundscape.defaultKey}},methods:{goToLibrary(){this.viewStateStore.setActiveView(p.Library)},async resetSoundscape(){var e,t;null==(e=this.optionsDropdown)||e.closeDropdown(),this.soundscapesStore.pause(this.soundscape.id),await this.soundscapesStore.delete(this.soundscape.id,{deleteDefault:!0}),await this.soundscapesStore.play(this.soundscape.id),null==(t=this.capture)||t.call(this,"sounds soundscape reset",{id:this.soundscape.id,type:this.soundscape.type,title:this.soundscape.title})}}}),(function(){var e=this,t=e._self._c;return e._self._setupProxy,t("app-view",{staticClass:"sounds-soundscape",scopedSlots:e._u([{key:"header",fn:function(){return[t("app-header",{on:{close:function(t){return e.viewStateStore.togglePopup(!1,{resetActiveView:!1})}},scopedSlots:e._u([{key:"left",fn:function(){return[t("app-header-control",{attrs:{"data-test":"sounds-back-to-list"},on:{click:e.goToLibrary}},[t("base-icon",{staticClass:"icon",attrs:{src:"icon/arrow-left"}})],1),t("sounds-audio-cover",{staticClass:"app-header-icon",attrs:{"thumbnail-url":e.soundscape.thumbnailSrc,icon:e.soundscape.icon,type:e.soundscape.type,size:"32px"}}),t("base-form",{staticClass:"item-title-form",attrs:{submit:()=>{},"submit-button":!1,"submit-on-blur":!0}},[t("form-editable-span",{staticClass:"title-input app-header-name",attrs:{placeholder:`Edit ${e.soundscape.type}`,editing:!1,"data-test":"sounds-soundscape-title-input"},model:{value:e.soundscape.title,callback:function(t){e.$set(e.soundscape,"title",t)},expression:"soundscape.title"}})],1)]},proxy:!0},{key:"right",fn:function(){return[e.isDefault?t("base-dropdown",{ref:"optionsDropdown",attrs:{"data-test":"soundscape-options"}},[t("base-dropdown-option",{attrs:{"data-test":"reset"},on:{click:e.resetSoundscape}},[t("base-icon",{attrs:{src:"undo-2"}}),e._v(" Reset ")],1)],1):e._e()]},proxy:!0}])})]},proxy:!0},{key:"body",fn:function(){return[t("div",{staticClass:"soundscapes-tracks"},[t("base-item-list",{attrs:{wrap:!0,"wrap-column-count":5,gap:"var(--spacing-3)"}},e._l(e.tracks,(function(s){return t("sounds-soundscape-track",{key:s.id,attrs:{"soundscape-id":e.soundscape.id,track:s}})})),1)],1)]},proxy:!0}])})}),[],!1,null,"4c646830").exports;const oe=O(e({name:"SoundsEmbed",components:{BaseDropdownOption:q,BaseDropdown:M,IframeHost:W,AppLoading:D,AppActionBanner:Y,AppHeaderControl:F,BaseIcon:m,SoundsAudioCover:T,AppHeader:u,AppView:c},setup:()=>({moreDropdown:s(),playerStore:h(),embedsStore:w(),viewStateStore:n(),capture:t("capture"),SPOTIFY_VOLUME_WARNING_TOOLTIP_TEXT:g,SPOTIFY_LOG_IN_WARNING_TOOLTIP_TEXT:I,SoundsDataType:N}),data:()=>({spotifyLogInBannerVisible:!localStorage.getItem(k),spotifyVolumeBannerVisible:!localStorage.getItem(_),spotifyVolumeBannerDismissed:!!localStorage.getItem(_)}),computed:{embed(){var e,t;const s=this.embedsStore.getEmbedFromId(this.viewStateStore.activeViewItemId);return s||(!this.viewStateStore.activeViewItemId||(null==(e=this.playerStore.activeItem)?void 0:e.type)!==N.Spotify&&(null==(t=this.playerStore.activeItem)?void 0:t.type)!==N.Youtube||console.error("[Sounds] Unable to find embed with id:",this.viewStateStore.activeViewItemId),new A({}))},playerVolume(){return this.playerStore.globalVolume},spotifyBannerVolumeText(){return this.playerVolume<x?C:j}},watch:{playerVolume(e){e>=x||(this.spotifyVolumeBannerVisible=!0)}},methods:{goToLibrary(){this.viewStateStore.setActiveView(p.Library)},async deleteCustomEmbed(){var e,t;null==(e=this.moreDropdown)||e.closeDropdown(),await this.playerStore.resetActiveItem(),await this.embedsStore.delete(this.embed.id),this.viewStateStore.activeViewItemId="",this.goToLibrary(),null==(t=this.capture)||t.call(this,"sounds integration delete",{id:this.embed.id,type:this.embed.type})},dismissSpotifyLogInBanner(){localStorage.setItem(k,"true"),this.spotifyLogInBannerVisible=!1},dismissSpotifyVolumeBanner(){localStorage.setItem(_,"true"),this.spotifyVolumeBannerVisible=!1,this.spotifyVolumeBannerDismissed=!0}}}),(function(){var e=this,t=e._self._c;return e._self._setupProxy,t("app-view",{staticClass:"sounds-embed",scopedSlots:e._u([{key:"header",fn:function(){return[t("app-header",{on:{close:function(t){return e.viewStateStore.togglePopup(!1,{resetActiveView:!1})}},scopedSlots:e._u([{key:"left",fn:function(){return[t("app-header-control",{attrs:{"data-test":"sounds-back-to-list"},on:{click:e.goToLibrary}},[t("base-icon",{staticClass:"icon",attrs:{src:"icon/arrow-left"}})],1),t("sounds-audio-cover",{staticClass:"app-header-icon",attrs:{"thumbnail-url":e.embed.thumbnailSrc,type:e.embed.type,size:"32px"}}),t("div",{staticClass:"app-header-name"},[e._v(e._s(e.embed.title))])]},proxy:!0},{key:"right",fn:function(){return[e.embed.custom?t("base-dropdown",{ref:"moreDropdown",attrs:{"data-test":"embed-options"}},[t("base-dropdown-option",{attrs:{"data-test":"delete"},on:{click:e.deleteCustomEmbed}},[t("base-icon",{attrs:{src:"trash-2"}}),e._v(" Delete ")],1)],1):e._e()]},proxy:!0}])}),e.embed.type===e.SoundsDataType.Spotify?[e.spotifyLogInBannerVisible?t("app-action-banner",{attrs:{"tooltip-text":e.SPOTIFY_LOG_IN_WARNING_TOOLTIP_TEXT,"dismiss-visible":!0},on:{dismiss:e.dismissSpotifyLogInBanner}},[t("span",[t("a",{staticClass:"banner-action",attrs:{href:"https://accounts.spotify.com/en/login",target:"_blank"}},[e._v(" Log into SpotifyÂ  "),t("base-icon",{attrs:{src:"external-link",size:"15px"}})],1),e._v(" to enable full-length songs ")])]):e._e(),e.spotifyVolumeBannerVisible?t("app-action-banner",{attrs:{"tooltip-text":e.SPOTIFY_VOLUME_WARNING_TOOLTIP_TEXT,"dismiss-visible":!e.spotifyVolumeBannerDismissed},on:{dismiss:e.dismissSpotifyVolumeBanner}},[e._v(" "+e._s(e.spotifyBannerVolumeText)+" ")]):e._e()]:e._e()]},proxy:!0},{key:"body",fn:function(){return[t("div",{staticClass:"iframe-content"},[t("app-loading"),e.embedsStore.messenger?t("iframe-host",{attrs:{"starting-height":"352px",messenger:e.embedsStore.messenger,"loading-spinner":!1,"fallback-timeout-delay":1e6,allow:"autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture; accelerometer; gyroscope; web-share","data-test":`sounds-iframe-${e.embed.type}`}}):e._e()],1)]},proxy:!0}])})}),[],!1,null,"5e668c95").exports;const re=O(e({name:"FormAsyncInput",components:{FormFieldWrapper:U},props:{...K,name:{type:String,default:"async-text-input"},autofocus:{type:Boolean,default:!1},placeholder:{type:String,default:""},value:{type:Object,required:!0},callback:{type:Function,required:!0},debounce:{type:Number,default:500}},emits:["input"],setup:()=>({input:s(),formFields:t("formFields"),callbackDebounce:void 0,callbackPromise:new Promise((e=>e()))}),data:()=>({text:"",pulse:!1,preventBlurSubmit:!1,processingCallback:!1}),created(){var e;null==(e=this.formFields)||e.addField(this.name,this.focus,this.pulseAndFocusInput)},destroyed(){var e;clearTimeout(this.callbackDebounce),null==(e=this.formFields)||e.removeField(this.name)},methods:{async focus(){var e;await i(),null==(e=this.input)||e.focus()},async pulseAndFocusInput(){await this.focus(),this.pulse=!0,await a(1e3),this.pulse=!1},emitOnInput(){clearTimeout(this.callbackDebounce),this.callbackPromise=new Promise((e=>{this.callbackDebounce=setTimeout((async()=>{this.processingCallback=!0;const t=await this.callback(this.text);this.$emit("input",Array.isArray(t)?t:{...this.value,...t}),this.processingCallback=!1,e()}),this.debounce)}))},async submitOnInput(){await this.callbackPromise.then((()=>{var e;null==(e=this.formFields)||e.submitOnFormInput()}))},async submitOnBlur(){await this.callbackPromise.then((()=>{var e;this.preventBlurSubmit||null==(e=this.formFields)||e.submitOnFormBlurAndNoneFocused()}))},async submitOnEnter(){await this.callbackPromise.then((()=>{var e;this.preventBlurSubmit=!0,null==(e=this.formFields)||e.focusNextInputOrSubmitIfLast(this.name)}))},setFocused(){this.preventBlurSubmit=!1},clearInput(){this.text=""}}}),(function(){var e=this,t=e._self._c;return e._self._setupProxy,t("form-field-wrapper",e._b({staticClass:"form-async-input",attrs:{disabled:e.disabled}},"form-field-wrapper",e.$props,!1),[t("input",{directives:[{name:"model",rawName:"v-model",value:e.text,expression:"text"}],ref:"input",staticClass:"hide-controls",class:{pulse:e.pulse},attrs:{autofocus:e.autofocus,"data-test":"form-async-input",placeholder:e.placeholder,disabled:e.disabled},domProps:{value:e.text},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submitOnEnter.apply(null,arguments)},input:[function(t){t.target.composing||(e.text=t.target.value)},function(t){e.emitOnInput(),e.submitOnInput()}],blur:e.submitOnBlur,focus:e.setFocused}}),t("div",{staticClass:"async-spinner",class:{visible:e.processingCallback}})])}),[],!1,null,"b2781271").exports,ne="We couldn't find any music under this link. Please ensure the link is not private or hidden.",pe="Please ensure your Spotify link is a playlist, track, or album.",le="Please only link to Spotify or YouTube.",de=e({name:"SoundsAddEmbed",components:{FormAsyncInput:re,BaseForm:H,AppView:c,AppHeader:u,BaseIcon:m,AppHeaderControl:F},setup:()=>({viewStateStore:n(),embedsStore:w(),playerStore:h(),capture:t("capture"),asyncInput:s()}),data:()=>({embedData:{type:void 0,externalType:void 0,thumbnailSrc:void 0,title:void 0,externalId:void 0,link:""}}),methods:{async validateNewEmbed(){if(this.embedData.link){if(!this.embedData.type)throw new o({message:le});if(!(this.embedData.type!==N.Spotify||this.embedData.externalType&&Object.values(V).includes(this.embedData.externalType)))throw new o({message:pe});if(!(this.embedData.externalId&&this.embedData.title&&this.embedData.thumbnailSrc&&this.embedData.externalType))throw new o({message:ne});if(Object.values(this.embedsStore.data).find((e=>e.externalId===this.embedData.externalId&&e.externalType===this.embedData.externalType&&e.type===this.embedData.type)))throw new o({message:"A sound matching this link already exists.",input:"link-input"})}},async addNewEmbed(){var e,t;if(!this.embedData.link)return;const s=new A({refreshTimestamp:Date.now(),custom:!0,...this.embedData});await this.embedsStore.create(s),null==(e=this.asyncInput)||e.clearInput(),null==(t=this.capture)||t.call(this,"sounds integration create",{id:s.id,type:s.type}),this.viewStateStore.resetBeforeViewChange(),await this.playerStore.play(s.id),this.viewStateStore.activeViewItemId=s.id,await this.viewStateStore.setActiveView(p.Item)},async goToLibraryView(){await this.viewStateStore.setActiveView(p.Library)},openHelpArticle(){var e;r("https://get.momentumdash.help/hc/en-us/articles/4405655736215-Sounds#Adding-your-own-playlists"),null==(e=this.capture)||e.call(this,"sounds integration learn more click")}}});const ce=O(e({name:"SoundsApp",components:{SoundsEmbed:oe,SoundsSoundscape:ae,SoundsLibrary:se,AppViewSwitchDynamic:d,AppPopup:l,SoundsAddEmbed:O(de,(function(){var e=this,t=e._self._c;return e._self._setupProxy,t("app-view",{staticClass:"sounds-add-embed",scopedSlots:e._u([{key:"header",fn:function(){return[t("app-header",{on:{close:function(t){return e.viewStateStore.togglePopup(!1,{resetActiveView:!1})}},scopedSlots:e._u([{key:"left",fn:function(){return[t("app-header-control",{attrs:{"data-test":"sounds-back-to-list"},on:{click:e.goToLibraryView}},[t("base-icon",{attrs:{src:"icon/arrow-left"}})],1),t("base-icon",{staticClass:"app-header-icon",attrs:{src:"icon/apps/sounds",size:"16px"}}),t("span",{staticClass:"app-header-name"},[e._v("Add music")])]},proxy:!0}])})]},proxy:!0},{key:"body",fn:function(){return[t("base-form",{attrs:{submit:e.addNewEmbed,validate:e.validateNewEmbed,"submit-on-input":!0,debounce:0,"submit-button":!1}},[t("form-async-input",{ref:"asyncInput",attrs:{callback:e.embedsStore.getExternalInfoForLink,autofocus:!0,placeholder:"Paste Spotify or Youtube link",name:"link-input"},model:{value:e.embedData,callback:function(t){e.embedData=t},expression:"embedData"}})],1),t("button",{staticClass:"button button-tertiary",on:{click:e.openHelpArticle}},[e._v("Learn more")])]},proxy:!0}])})}),[],!1,null,"7aed4593").exports},setup:()=>({viewStateStore:n(),playerStore:h(),SoundsDataType:N}),computed:{activeItemId(){var e;return null==(e=this.playerStore.activeItem)?void 0:e.id},libraryOpen(){return this.viewStateStore.activeViewId===p.Library},itemOpen(){return this.viewStateStore.activeViewId===p.Item},addEmbedOpen(){return this.viewStateStore.activeViewId===p.AddEmbed}},mounted(){this.viewStateStore.popupFirstMounted=!0,this.playerStore.refresh(),X.registerEventListener("sounds:goBackOrClose","keyup",27,this.goToLibraryViewOrCloseApp)},destroyed(){X.removeEventListener("sounds:goBackOrClose","keyup",27,this.goToLibraryViewOrCloseApp)},methods:{async goToLibraryViewOrCloseApp(){this.addEmbedOpen?await this.viewStateStore.setActiveView(p.Library):this.viewStateStore.togglePopup(!1)}}}),(function(){var e,t=this,s=t._self._c;return t._self._setupProxy,s("app-popup",{attrs:{width:560,region:"top-left",position:"bottom-right",focused:t.viewStateStore.focused},on:{close:function(e){return t.viewStateStore.togglePopup(!1)}},nativeOn:{click:function(e){return t.viewStateStore.focus()}}},[s("app-view-switch-dynamic",{attrs:{"order-key":null==(e=t.viewStateStore.activeView)?void 0:e.order,duration:t.viewStateStore.popupActive?300:0,"transition-group":!0}},[s("sounds-library",{directives:[{name:"show",rawName:"v-show",value:t.libraryOpen,expression:"libraryOpen"}],key:"library",class:{open:t.libraryOpen}}),s("sounds-soundscape",{directives:[{name:"show",rawName:"v-show",value:t.itemOpen&&t.playerStore.activeItemIsSoundscape,expression:"itemOpen && playerStore.activeItemIsSoundscape"}],key:"item-soundscape"}),s("sounds-embed",{directives:[{name:"show",rawName:"v-show",value:t.itemOpen&&t.playerStore.activeItemIsEmbed,expression:"itemOpen && playerStore.activeItemIsEmbed"}],key:"item-embed"}),s("sounds-add-embed",{directives:[{name:"show",rawName:"v-show",value:t.addEmbedOpen,expression:"addEmbedOpen"}],key:"item-add-embed"})],1)],1)}),[],!1,null,"7d70d75e").exports;export{ce as default};