import e from"./LocationTypeahead-mo6tTN-h.js";import{aa as t,v as a}from"./dynamic-import-helper-Gh3O-GNF.js";import{g as o}from"./globalKeyEventManager-DTQSIy-h.js";import{n as i}from"./_plugin-vue2_normalizer-DeUNqxFl.js";import"./SoftFocus-BUhesXB-.js";import"./SmoothReflow-44YdkIfk.js";import"./ResizeSensor-ZXOsDHeC.js";import"./allComponentsMounted-Dqy5K4Uf.js";import"./array-YYQw31d9.js";import"./main-DaaZyiXy.js";import"./Logger-DgjqecXr.js";import"./string-DLOjEt1Y.js";const n=t.map((({name:e,id:t})=>{const a=e.includes("-"),o=e.substring(3),i=o.replace(":",""),[n,s]=o.substring(1).split(":");return{name:e,shortName:e,offset:(60*n+s)*(a?-1:1),searchable:i,timeZoneId:t}}));const s=i({name:"TimezoneTypeahead",components:{LocationTypeahead:e},props:{value:{type:Object,required:!0},componentFieldWarnings:{type:Array,default:()=>[]}},data:()=>({warning:!1,loadingTimezone:!1}),computed:{transformedValue(){return{name:this.value.timeZoneName,...this.value}}},watch:{componentFieldWarnings(e){e.includes("timeZoneId")&&(this.warning=!0),setTimeout((()=>this.warning=!1),1e3)}},created(){o.registerEventListener("closeResults","keyup",27,(()=>{this.$refs.typeahead.clear()}))},destroyed(){o.removeEventListener("closeResults","keyup",27)},methods:{async getTimezone({shortName:e,name:t,latitude:o,longitude:i,offset:n=0,timeZoneId:s=""}={}){if(this.$emit("input",{shortName:e,timeZoneName:t,offset:n,timeZoneId:s}),void 0===arguments[0].timeZoneId){this.loadingTimezone=!0;try{const{data:{name:n,offset:s}}=await a.get(`/timezones:search?latitude=${o}&longitude=${i}`);this.$emit("input",{shortName:e,name:name,offset:s,timeZoneId:n,timeZoneName:t})}catch(r){console.error(r)}finally{this.loadingTimezone=!1}}},interceptUtcSearch(e){var t;const a=e.toLowerCase().trim();if(a.includes("utc")||a.includes("gmt")){const e=(null==(t=a.replace(":","").match(/(\d|-|\+)+/))?void 0:t[0])||"",o=m.utils.fuzzyFilter(e,n,"searchable");if(o.length)return o}}}},(function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"label-wrapper"},[t("label",[e._v("Location")]),e.loadingTimezone?t("div",{staticClass:"loading-icon",attrs:{"data-test":"loading-timezone"}}):e._e()]),t("location-typeahead",{ref:"typeahead",class:{pulse:e.warning},attrs:{"before-fetch-results":e.interceptUtcSearch,value:e.transformedValue,type:"timezone"},on:{input:e.getTimezone}})],1)}),[],!1,null,"86a44bde").exports;export{s as default};